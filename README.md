lacells-creator
===============

Script for generating a cell tower database for NetworkLocation from the μg Project

The μg Project at https://github.com/microg is building a number of open source components to replace Google Mobile Services on Android phones. One of the older components is called NetworkLocation and it uses a on phone sqlite database to resolve the locations of cell towers seen by the phone.

The database is fairly old now so the scripts on this page will generate a new database and place it on the phone. The database generated with this script will have an additional field not used by NetworkLocation but used on some other software I have written.

### Requirements

1. bash - Main script is written in bash
2. wget - Used to pull CSV files from OpenCellId and Mozilla Location Services
3. OpenCellID API Key - Needed to pull CSV files from OpenCellID. Get one for free at http://wiki.opencellid.org/wiki/How_to_join
4. sqlite3 - Used to generate the actual database for the phone
5. adb - Used to push database file to the phone.

### Setup
You need to create a configuration:

1. copy the provided example configuration: `cp gen_lacells_conf.sample gen_lacells_conf
1. edit your copy to reflect your settings. You must specify at least your OpenCellId API key, everything else is optional. All the options are documented in the example config file, so you can see there for details.

### How To Run
1. Plug phone into computer using USB cable. Phone should have development options enabled to the computer can use adb to push the final file to the phone.
2. From the bash shell prompt enter:

```
	cd gen_lacells_directory
	./gen_lacells
```
or

```
	cd gen_lacells_directory
	./gen_lacells_merged
```

The `gen_lacells_merged` version of the script will merge duplicate tower information where both OpenCellID and Mozilla Location Services have information on the same tower. The `gen_lacells` script will leave the duplicates in place.

### Other Considerations

The OpenCellId project limits downloads to one per day per API key. So this script will only run correctly the first time it is run per day.

Script in repository eliminates all tower information for areas outside of the United States of America – unless you edit the `MCC` setting in your config file accordingly (e.g. comment it out altogether to keep worldwide data, or replace it with MCC values from your region).

### Comment on database sizes (20Dec2014)
The database generated by this script is significantly larger than the one found through the links at http://forum.xda-developers.com/showthread.php?t=1715375

There are several reasons for that:
1. That database was created nearly two years ago and the database at OpenCellID has grown since then.
2. This script add towers from Mozilla Location Services.
3. I have added a couple of fields.
4. I have created indices for faster run time access.

To the first point, the 95,171,584 byte cells-world.db contains 2,486,708 cell towers. As of 20Dec2014, a database from OpenCellId for the whole world will contain 6,891,208 towers (177% increase in tower count).

To the second point, adding Mozilla data increases the non-duplicate tower count to 8,456,327 a total 240% greater than the original database.

To the last point, adding indices for faster run time access increase the non-duplicate combined database from 423,677,952 to 729,165,824 bytes (72% increase).

### Final Note

19Dec2014: If you need a `lacells.db` file for use by my gsm-location backend located at https://github.com/n76/Local-GSM-Backend then you can use the settings menu for that backend to generate the database on the phone with no external script.

It is significantly faster to generate the database file on a laptop or desktop computer but more convenient to generate it on the phone so I am leaving this script available.
